<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso WiFi Gratis - Apoyo Migrantes Retornados</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4b5563;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 16px;
            width: 100%;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .terms {
            font-size: 12px;
            color: #6b7280;
            text-align: center;
            margin-top: 20px;
            line-height: 1.5;
        }

        .terms a {
            color: #4f46e5;
            text-decoration: none;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .success-message i {
            font-size: 60px;
            color: #10b981;
            margin-bottom: 20px;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        .countdown {
            font-size: 14px;
            color: #6b7280;
            margin-top: 15px;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }

        /* Estilos para botones sociales */
        .social-section {
            margin-bottom: 25px;
        }

        .social-section h3 {
            font-size: 16px;
            color: #4b5563;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .social-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .social-btn:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
        }

        .social-btn.connected {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .social-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .social-btn-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .social-icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }

        .social-name {
            font-weight: 600;
            font-size: 14px;
        }

        .social-status {
            font-size: 12px;
            color: #6b7280;
        }

        .social-btn.connected .social-status {
            color: #10b981;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #4f46e5;
        }

        .modal-input {
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn-primary {
            background: #4f46e5;
            color: white;
        }

        .modal-btn-secondary {
            background: #e5e7eb;
            color: #4b5563;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .content {
                padding: 25px;
            }
            
            .container {
                border-radius: 15px;
                margin: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            input, .btn {
                padding: 16px;
                font-size: 16px;
            }
        }

        /* Para evitar zoom en iOS */
        @media screen and (max-width: 480px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }

        /* Mejorar botones para touch */
        .btn, .social-btn, .modal-btn {
            min-height: 44px;
            touch-action: manipulation;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-wifi"></i> WiFi Gratis</h1>
            <p>Complete sus datos para acceder a Internet y recibir apoyo laboral</p>
        </div>

        <div class="content">
            <div class="error-message" id="errorMessage"></div>
            
            <form id="registrationForm">
                <div class="form-group">
                    <label for="fullName"><i class="fas fa-user"></i> Nombre Completo *</label>
                    <input type="text" id="fullName" required placeholder="Ingrese su nombre completo">
                </div>

                <div class="form-group">
                    <label for="phone"><i class="fas fa-phone"></i> Teléfono / WhatsApp *</label>
                    <input type="tel" id="phone" required placeholder="Ej: +502 1234 5678" inputmode="tel">
                </div>

                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Correo Electrónico *</label>
                    <input type="email" id="email" required placeholder="ejemplo@correo.com" inputmode="email">
                </div>

                <!-- Sección de redes sociales con botones -->
                <div class="social-section">
                    <h3><i class="fas fa-share-alt"></i> Conectar Redes Sociales (Opcional)</h3>
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                        Conecta tus redes para recibir oportunidades laborales personalizadas
                    </p>
                    
                    <div class="social-buttons">
                        <button type="button" class="social-btn" id="facebookBtn" onclick="openSocialModal('facebook')">
                            <div class="social-btn-left">
                                <div class="social-icon" style="color: #1877F2;">
                                    <i class="fab fa-facebook-f"></i>
                                </div>
                                <div>
                                    <div class="social-name">Facebook</div>
                                    <div class="social-status" id="facebookStatus">No conectado</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-plus"></i>
                            </div>
                        </button>
                        
                        <button type="button" class="social-btn" id="instagramBtn" onclick="openSocialModal('instagram')">
                            <div class="social-btn-left">
                                <div class="social-icon" style="color: #E4405F;">
                                    <i class="fab fa-instagram"></i>
                                </div>
                                <div>
                                    <div class="social-name">Instagram</div>
                                    <div class="social-status" id="instagramStatus">No conectado</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-plus"></i>
                            </div>
                        </button>
                        
                        <button type="button" class="social-btn" id="twitterBtn" onclick="openSocialModal('twitter')">
                            <div class="social-btn-left">
                                <div class="social-icon" style="color: #1DA1F2;">
                                    <i class="fab fa-twitter"></i>
                                </div>
                                <div>
                                    <div class="social-name">Twitter/X</div>
                                    <div class="social-status" id="twitterStatus">No conectado</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-plus"></i>
                            </div>
                        </button>
                        
                        <button type="button" class="social-btn" id="linkedinBtn" onclick="openSocialModal('linkedin')">
                            <div class="social-btn-left">
                                <div class="social-icon" style="color: #0077B5;">
                                    <i class="fab fa-linkedin-in"></i>
                                </div>
                                <div>
                                    <div class="social-name">LinkedIn</div>
                                    <div class="social-status" id="linkedinStatus">No conectado</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-plus"></i>
                            </div>
                        </button>
                        
                        <button type="button" class="social-btn" id="whatsappBtn" onclick="openSocialModal('whatsapp')">
                            <div class="social-btn-left">
                                <div class="social-icon" style="color: #25D366;">
                                    <i class="fab fa-whatsapp"></i>
                                </div>
                                <div>
                                    <div class="social-name">WhatsApp</div>
                                    <div class="social-status" id="whatsappStatus">No agregado</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-plus"></i>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Campos ocultos para almacenar los datos -->
                    <input type="hidden" id="facebookProfile" name="facebookProfile">
                    <input type="hidden" id="instagramProfile" name="instagramProfile">
                    <input type="hidden" id="twitterProfile" name="twitterProfile">
                    <input type="hidden" id="linkedinProfile" name="linkedinProfile">
                    <input type="hidden" id="whatsappNumber" name="whatsappNumber">
                </div>
                
                <div class="loader" id="loader"></div>
                
                <button type="submit" class="btn" id="submitBtn">
                    <i class="fas fa-unlock-alt"></i> Conectar a Internet
                </button>
                
                <p class="terms">
                    Al conectarse, acepta nuestros 
                    <a href="#" onclick="showTerms()">Términos de Servicio</a> y 
                    <a href="#" onclick="showPrivacy()">Política de Privacidad</a>
                </p>
            </form>

            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                <h2>¡Registro Exitoso!</h2>
                <p style="margin: 15px 0;">Ya tienes acceso a Internet</p>
                <p><strong>Código de acceso:</strong></p>
                <p id="accessCode" style="font-size: 28px; color: #4f46e5; font-weight: bold; margin: 10px 0;"></p>
                <p class="countdown">Redirigiendo en <span id="countdown">5</span> segundos...</p>
                <p style="font-size: 14px; margin-top: 20px; color: #666;">
                    Este código será válido por 24 horas<br>
                    Te contactaremos pronto con oportunidades laborales
                </p>
            </div>
        </div>
    </div>

    <!-- Modal para ingresar perfiles sociales -->
    <div class="modal" id="socialModal">
        <div class="modal-content">
            <h3 id="modalTitle">Conectar Red Social</h3>
            <div class="modal-input">
                <input type="text" id="socialInput" class="full-width" placeholder="">
                <p id="modalPlaceholder" style="font-size: 12px; color: #666; margin-top: 8px;"></p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="saveSocialProfile()">Guardar</button>
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Configuración
        const API_URL = 'https://portal-wifi-captive.onrender.com/api';
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // Estado de la aplicación
        let currentSocialNetwork = '';
        const socialData = {
            facebookProfile: '',
            instagramProfile: '',
            twitterProfile: '',
            linkedinProfile: '',
            whatsappNumber: ''
        };
        
        // Modal functions
        function openSocialModal(network) {
            currentSocialNetwork = network;
            
            const config = {
                'facebook': {
                    title: 'Conectar Facebook',
                    placeholder: 'Ingresa tu perfil de Facebook',
                    example: 'Ej: nombre.usuario o facebook.com/nombre.usuario'
                },
                'instagram': {
                    title: 'Conectar Instagram',
                    placeholder: 'Ingresa tu usuario de Instagram',
                    example: 'Ej: @usuario'
                },
                'twitter': {
                    title: 'Conectar Twitter/X',
                    placeholder: 'Ingresa tu usuario de Twitter/X',
                    example: 'Ej: @usuario'
                },
                'linkedin': {
                    title: 'Conectar LinkedIn',
                    placeholder: 'Ingresa tu perfil de LinkedIn',
                    example: 'Ej: linkedin.com/in/usuario'
                },
                'whatsapp': {
                    title: 'Agregar WhatsApp',
                    placeholder: 'Ingresa tu número de WhatsApp',
                    example: 'Ej: +502 1234 5678'
                }
            };
            
            const modal = document.getElementById('socialModal');
            const title = document.getElementById('modalTitle');
            const input = document.getElementById('socialInput');
            const placeholder = document.getElementById('modalPlaceholder');
            
            title.textContent = config[network].title;
            input.placeholder = config[network].placeholder;
            placeholder.textContent = config[network].example;
            input.value = socialData[currentSocialNetwork + (network === 'whatsapp' ? 'Number' : 'Profile')] || '';
            
            modal.style.display = 'flex';
            input.focus();
        }
        
        function saveSocialProfile() {
            const input = document.getElementById('socialInput');
            const value = input.value.trim();
            
            if (value) {
                const fieldName = currentSocialNetwork + (currentSocialNetwork === 'whatsapp' ? 'Number' : 'Profile');
                
                // Guardar en el objeto de datos
                socialData[fieldName] = value;
                
                // Guardar en el campo oculto
                document.getElementById(fieldName).value = value;
                
                // Actualizar la UI del botón
                const button = document.getElementById(`${currentSocialNetwork}Btn`);
                const statusElement = document.getElementById(`${currentSocialNetwork}Status`);
                
                button.classList.add('connected');
                statusElement.textContent = currentSocialNetwork === 'whatsapp' ? 'Agregado' : 'Conectado';
                statusElement.style.color = '#10b981';
                
                // Cambiar ícono
                const icon = button.querySelector('.fa-plus');
                if (icon) {
                    icon.className = 'fas fa-check';
                    icon.style.color = '#10b981';
                }
                
                // Mostrar mensaje temporal
                showToast(`${currentSocialNetwork.charAt(0).toUpperCase() + currentSocialNetwork.slice(1)} conectado exitosamente`);
            }
            
            closeModal();
        }
        
        function closeModal() {
            document.getElementById('socialModal').style.display = 'none';
        }
        
        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Validar email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Validar teléfono
        function validatePhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            return cleaned.length >= 8;
        }
        
        // Mostrar error
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            // Scroll to error
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Form submission
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            const form = document.getElementById('registrationForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Resetear mensajes
            errorMessage.style.display = 'none';
            
            // Obtener valores
            const fullName = document.getElementById('fullName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            
            // Validaciones
            if (!fullName || !phone || !email) {
                showError('Por favor complete todos los campos requeridos');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('Por favor ingrese un email válido');
                return;
            }
            
            if (!validatePhone(phone)) {
                showError('Por favor ingrese un número de teléfono válido');
                return;
            }
            
            // Deshabilitar botón y mostrar loader
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            loader.style.display = 'block';
            
            // Preparar datos para enviar
            const userData = {
                fullName: fullName,
                phone: phone,
                email: email,
                facebookProfile: socialData.facebookProfile,
                instagramProfile: socialData.instagramProfile,
                twitterProfile: socialData.twitterProfile,
                linkedinProfile: socialData.linkedinProfile,
                whatsappNumber: socialData.whatsappNumber,
                migrationStatus: 'retornado',
                employmentInterest: ['construccion', 'servicios', 'agricultura'],
                contactPreference: socialData.whatsappNumber ? ['whatsapp', 'llamada'] : ['llamada', 'email']
            };
            
            try {
                console.log('Enviando datos:', userData);
                console.log('URL de API:', API_URL + '/register');
                
                const response = await fetch(API_URL + '/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Session-Id': sessionId,
                        'Wifi-Network': 'WiFi-Gratis - Apoyo Migrantes'
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                console.log('Respuesta del servidor:', result);
                
                if (result.success) {
                    // Ocultar formulario y mostrar éxito
                    form.style.display = 'none';
                    loader.style.display = 'none';
                    
                    // Mostrar código de acceso
                    document.getElementById('accessCode').textContent = result.data.accessCode;
                    successMessage.style.display = 'block';
                    
                    // Guardar en localStorage
                    localStorage.setItem('wifiAccessCode', result.data.accessCode);
                    localStorage.setItem('wifiUserEmail', email);
                    localStorage.setItem('wifiUserName', fullName);
                    
                    // Iniciar cuenta regresiva
                    let countdown = result.countdown || 5;
                    const countdownElement = document.getElementById('countdown');
                    
                    const countdownInterval = setInterval(() => {
                        countdown--;
                        countdownElement.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            // Redirigir
                            window.location.href = result.redirectUrl || 'https://www.google.com';
                        }
                    }, 1000);
                    
                } else {
                    showError(result.error || 'Error en el registro. Por favor intente nuevamente.');
                    resetForm();
                }
            } catch (error) {
                console.error('Error en la solicitud:', error);
                showError('Error de conexión. Verifique su conexión a Internet e intente nuevamente.');
                resetForm();
            }
        });
        
        function resetForm() {
            const submitBtn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-unlock-alt"></i> Conectar a Internet';
            loader.style.display = 'none';
        }
        
        // Términos y privacidad
        function showTerms() {
            alert('TÉRMINOS DE SERVICIO\n\n1. El servicio WiFi es gratuito por 24 horas.\n2. Usted acepta usar el servicio de manera responsable.\n3. Nos comprometemos a proteger su información personal.\n4. El servicio puede interrumpirse por mantenimiento.\n5. Al registrarse, acepta recibir información sobre oportunidades laborales.');
        }
        
        function showPrivacy() {
            alert('POLÍTICA DE PRIVACIDAD\n\n1. Recopilamos información para brindar el servicio WiFi y apoyo laboral.\n2. Su información será usada solo para los fines establecidos.\n3. No compartimos datos personales con terceros sin consentimiento.\n4. Puede solicitar la eliminación de sus datos contactándonos.\n5. Implementamos medidas de seguridad para proteger su información.');
        }
        
        // Detectar si ya tiene acceso guardado
        window.addEventListener('load', () => {
            const savedCode = localStorage.getItem('wifiAccessCode');
            if (savedCode) {
                const userName = localStorage.getItem('wifiUserName') || 'Usuario';
                const useSaved = confirm(`Hola ${userName}, ya tienes un código de acceso guardado: ${savedCode}\n\n¿Deseas usarlo para conectarte ahora?`);
                
                if (useSaved) {
                    window.location.href = 'https://www.google.com';
                } else {
                    // Limpiar localStorage si no quiere usar el código guardado
                    localStorage.removeItem('wifiAccessCode');
                    localStorage.removeItem('wifiUserEmail');
                    localStorage.removeItem('wifiUserName');
                }
            }
            
            // Cerrar modal si se hace clic fuera
            document.getElementById('socialModal').addEventListener('click', (e) => {
                if (e.target.id === 'socialModal') {
                    closeModal();
                }
            });
        });
        
        // Estilos CSS para animaciones del toast
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>